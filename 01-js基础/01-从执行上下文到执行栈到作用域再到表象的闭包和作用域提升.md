# 1 执行上下文
## 是什么
执行上下文是js代码执行环境的抽象。

## 类型
到目前为止可见的执行上下文有三种:
- 全局执行上下文
- 函数执行上下文
- eval函数执行上下文

## 创建时机
当执行的时候创建执行上下文。例如： 
- js代码段 开始执行时 会先创建全局执行上下文
- 函数 被调用时 开始创建函数执行上下文

## 创建过程
- this值确定
- 创建词法环境
- 创建环境变量

### this值确定
- 全局执行上下文，this被确定为全局对象。
- 函数执行上下文中，this取决于该函数是如何被调用的。

### 词法环境
词法环境可以理解为一个object结构，其中key为变量或者函数的标识符，value为变量或者函数的引用。
- 分类
    - 环境记录器：记录当前词法环境中定义的变量或函数。
        - 在全局执行上下文中，词法环境里面含有内建的ObjectObject/Array的原型函数、自定义的全局变量或函数、全局对象
        - 在函数执行上下文中，词法环境中包含函数中声明的变量函数和函数的参数对象
    - 外部环境引用
        - 全局执行上下文中，外部环境引用为null
        - 在函数执行上下文中，外部环境引用可能是全局环境，或者任何包含此内部函数的外部函数。
- 初始化值： var声明的变量的被初始化为undefined

### 变量环境
变量环境其实就是另一个词法环境。

在 ES6 中，词法环境和变量环境的一个不同就是前者被用来存储函数声明和变量（let 和 const）绑定，而后者只用来存储 var 变量绑定。

在创建上下文过程中，引擎检查代码找出变量和函数声明，虽然函数声明完全存储在环境中，但是变量最初设置为 undefined（var 情况下），或者未初始化（let 和 const 情况下）。

这就是为什么你可以在声明之前访问 var 定义的变量（虽然是 undefined），但是在声明之前访问 let 和 const 的变量会得到一个引用错误。

```
console.log(a) // undefined
var a;
```
```
console.log(b) //  Missing initializer in const declaration
const b;
```

## 执行阶段
如果 JavaScript 引擎不能在源码中声明的实际位置找到 let 变量的值，它会被赋值为 undefined。

```
console.log(b) // b is not defined
let b;
```

```
let b;
console.log(b) //  undefined
```

# todo
## 关于变量提升覆盖
函数声明
var fun1 = function(){}
function fun1(){}
这两个哪个会覆盖哪个？
## 关于for(let i ) 和for(var i )


# 参考：
- [理解 JavaScript 中的执行上下文和执行栈](https://juejin.cn/post/6844903682283143181#heading-4)